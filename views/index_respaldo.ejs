<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comparador SUA vs DATA</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .block {
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input[type="text"], input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .options {
      margin: 20px 0;
      padding: 10px;
      background: #f0f8ff;
      border: 1px solid #cce;
      border-radius: 6px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
      font-size: 16px;
    }
    button:hover {
      background: #0056b3;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    .card-upload {
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      text-align: center;
    }
    .card-upload:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .card-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .card-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .card-text {
      color: #555;
      font-size: 14px;
    }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    .results {
      margin-top: 25px;
      padding: 15px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    .download-link {
      display: block;
      margin: 20px 0;
      text-align: center;
    }
    
  </style>
</head>
<body>
  <div class="container">
    <h1>Comparador SUA vs DATA</h1>
    <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
      
      <div class="grid">
        <!-- SUA -->
        <div class="block">
          <h3>Archivo SUA</h3>
          <label for="sua">Subir archivo:</label>
          <div class="card-upload" id="xlsxSua">
            <div class="card-body">
              <h5 class="card-title">Archivo SUA</h5>
              <svg xmlns="http://www.w3.org/2000/svg" height="100" width="300" viewBox="-343.4625 -532.5 2976.675 3195"><path d="M1437.75 1011.75L532.5 852v1180.393c0 53.907 43.7 97.607 97.607 97.607h1562.036c53.907 0 97.607-43.7 97.607-97.607V1597.5z" fill="#185C37"/><path d="M1437.75 0H630.107C576.2 0 532.5 43.7 532.5 97.607V532.5l905.25 532.5L1917 1224.75 2289.75 1065V532.5z" fill="#21A366"/><path d="M532.5 532.5h905.25V1065H532.5z" fill="#107C41"/><path d="M1180.393 426H532.5v1331.25h647.893c53.834-.175 97.432-43.773 97.607-97.607V523.607c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".1"/><path d="M1127.143 479.25H532.5V1810.5h594.643c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><path d="M1127.143 479.25H532.5V1704h594.643c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><path d="M1073.893 479.25H532.5V1704h541.393c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><linearGradient gradientTransform="matrix(1 0 0 -1 0 2132)" y2="404.982" x2="967.987" y1="1729.018" x1="203.513" gradientUnits="userSpaceOnUse" id="a"><stop offset="0" stop-color="#18884f"/><stop offset=".5" stop-color="#117e43"/><stop offset="1" stop-color="#0b6631"/></linearGradient><path d="M97.607 479.25h976.285c53.907 0 97.607 43.7 97.607 97.607v976.285c0 53.907-43.7 97.607-97.607 97.607H97.607C43.7 1650.75 0 1607.05 0 1553.143V576.857c0-53.907 43.7-97.607 97.607-97.607z" fill="url(#a)"/><path d="M302.3 1382.264l205.332-318.169L319.5 747.683h151.336l102.666 202.35c9.479 19.223 15.975 33.494 19.49 42.919h1.331a798.667 798.667 0 0121.3-44.677L725.371 747.79H864.3l-192.925 314.548L869.2 1382.263H721.378L602.79 1160.158a186.298 186.298 0 01-14.164-29.66h-1.757a140.458 140.458 0 01-13.739 28.755l-122.102 223.011z" fill="#FFF"/><path d="M2192.143 0H1437.75v532.5h852V97.607C2289.75 43.7 2246.05 0 2192.143 0z" fill="#33C481"/><path d="M1437.75 1065h852v532.5h-852z" fill="#107C41"/></svg>
              <p class="card-text" id="nameSua">Click para subir archivo</p>
            </div>
          </div>

          <input type="file" name="sua" id="fileInputSua" style="display: none;" />

          <label for="suaSheet">Hoja:</label>
          <input type="text" name="suaSheet" placeholder="Ej. Hoja1" />

          <label for="suaColumn">Columna:</label>
          <input type="text" name="suaColumn" placeholder="Ej. F" value="F" />
        </div>

        <!-- DATA -->
        <div class="block">
          <h3>Archivo DATA</h3>
          <label for="data">Subir archivo:</label>
          <div class="card-upload" id="xlsxData">
            <div class="card-body">
              <h5 class="card-title">Archivo Data</h5>
              <svg xmlns="http://www.w3.org/2000/svg" height="100" width="300" viewBox="-343.4625 -532.5 2976.675 3195"><path d="M1437.75 1011.75L532.5 852v1180.393c0 53.907 43.7 97.607 97.607 97.607h1562.036c53.907 0 97.607-43.7 97.607-97.607V1597.5z" fill="#185C37"/><path d="M1437.75 0H630.107C576.2 0 532.5 43.7 532.5 97.607V532.5l905.25 532.5L1917 1224.75 2289.75 1065V532.5z" fill="#21A366"/><path d="M532.5 532.5h905.25V1065H532.5z" fill="#107C41"/><path d="M1180.393 426H532.5v1331.25h647.893c53.834-.175 97.432-43.773 97.607-97.607V523.607c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".1"/><path d="M1127.143 479.25H532.5V1810.5h594.643c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><path d="M1127.143 479.25H532.5V1704h594.643c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><path d="M1073.893 479.25H532.5V1704h541.393c53.834-.175 97.432-43.773 97.607-97.607V576.857c-.175-53.834-43.773-97.432-97.607-97.607z" opacity=".2"/><linearGradient gradientTransform="matrix(1 0 0 -1 0 2132)" y2="404.982" x2="967.987" y1="1729.018" x1="203.513" gradientUnits="userSpaceOnUse" id="a"><stop offset="0" stop-color="#18884f"/><stop offset=".5" stop-color="#117e43"/><stop offset="1" stop-color="#0b6631"/></linearGradient><path d="M97.607 479.25h976.285c53.907 0 97.607 43.7 97.607 97.607v976.285c0 53.907-43.7 97.607-97.607 97.607H97.607C43.7 1650.75 0 1607.05 0 1553.143V576.857c0-53.907 43.7-97.607 97.607-97.607z" fill="url(#a)"/><path d="M302.3 1382.264l205.332-318.169L319.5 747.683h151.336l102.666 202.35c9.479 19.223 15.975 33.494 19.49 42.919h1.331a798.667 798.667 0 0121.3-44.677L725.371 747.79H864.3l-192.925 314.548L869.2 1382.263H721.378L602.79 1160.158a186.298 186.298 0 01-14.164-29.66h-1.757a140.458 140.458 0 01-13.739 28.755l-122.102 223.011z" fill="#FFF"/><path d="M2192.143 0H1437.75v532.5h852V97.607C2289.75 43.7 2246.05 0 2192.143 0z" fill="#33C481"/><path d="M1437.75 1065h852v532.5h-852z" fill="#107C41"/></svg>
              <p class="card-text" id="nameData">Click para subir archivo</p>
            </div>
          </div>
          <input type="file" name="data" id="fileInputData" style="display: none;"/>

          <label for="dataSheet">Hoja:</label>
          <input type="text" name="dataSheet" placeholder="Ej. Hoja1" />

          <label for="dataColumn">Columna:</label>
          <input type="text" name="dataColumn" placeholder="Ej. F" value="F" />
        </div>
      </div>

      <!-- Opciones -->
      <div class="options">
        <label><input type="checkbox" name="removeAccents" value="true" /> Quitar acentos</label>
        <label><input type="checkbox" name="trimSpaces" value="true" /> Quitar espacios extra</label>
        <label><input type="checkbox" name="showMissing" value="true" checked /> Mostrar no coincidentes</label>
        <label><input type="checkbox" name="showMatches" value="true" /> Mostrar coincidentes</label>
        <label><input type="checkbox" name="exportResults" value="true" /> Exportar resultados a XLSX</label>
      </div>

      <button type="submit">Aplicar y Comparar</button>
    </form>

    <div id="spinner" class="spinner"></div>

    <!-- Resultados -->
    <% if (showMissing && missing && missing.length > 0) { %>
      <div class="results">
        <h2>⚠️ Nombres en DATA que no están en SUA</h2>
        <p>Total: <strong><%= missing.length %></strong></p>
        <table>
          <thead><tr><th>Nombre</th></tr></thead>
          <tbody>
            <% missing.forEach(name => { %>
              <tr><td><%= name %></td></tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else if (showMissing && missing) { %>
      <div class="results">
        <h2>✅ No hay nombres en DATA que falten en SUA</h2>
      </div>
    <% } %>

    <% if (showMatches && matches && matches.length > 0) { %>
      <div class="results">
        <h2>✅ Nombres en DATA que coinciden en SUA</h2>
        <p>Total: <strong><%= matches.length %></strong></p>
        <table>
          <thead><tr><th>Nombre</th></tr></thead>
          <tbody>
            <% matches.forEach(name => { %>
              <tr><td><%= name %></td></tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else if (showMatches && matches) { %>
      <div class="results">
        <h2>⚠️ No hay coincidencias</h2>
      </div>
    <% } %>

    <% if (exportFilename) { %>
      <div class="download-link">
        <a href="/download/<%= exportFilename %>" download>📥 Descargar XLSX de resultados</a>
      </div>
    <% } %>
  </div>

  <script>
    let cardSua = document.getElementById("xlsxSua");
    let inputSua = document.getElementById("fileInputSua");
    let nameSua = document.getElementById("nameSua");

    cardSua.addEventListener("click", () => inputSua.click());

    inputSua.addEventListener("change", (e) => {
      let file = e.target.files[0];
      if (!file) return;
      nameSua.textContent = file.name;
    });

    
    let cardData = document.getElementById("xlsxData");
    let inputData = document.getElementById("fileInputData");
    let nameData = document.getElementById("nameData");

    cardData.addEventListener("click", () => inputData.click());

    inputData.addEventListener("change", (e) => {
      let file = e.target.files[0];
      if (!file) return;
      nameData.textContent = file.name;
    });

    let form = document.getElementById("uploadForm");
    let spinner = document.getElementById("spinner");
    form.addEventListener("submit", () => {
      spinner.style.display = "block";
    });
  </script>
</body>
</html>